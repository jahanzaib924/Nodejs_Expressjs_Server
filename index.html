<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link />
  </head>
  <body>
    <h1>Todo App with server</h1>

    <form onsubmit="postTodo(); return false">
      todo: <input id="todo" type="text" required />
      <button type="submit">Add</button>
    </form>
    <button onclick="getAllTodos()">Refresh</button>
    <button onclick="deleteAllTodos()">DeleteAll</button>
    <button o onclick="deleteTodo()">DeleteAll</button>
     <div id="result">
    <button>delete</button>

</div>
    <script>
         let baseUrl =
            (document.location.protocol === 'https:') ?
                "https://adorable-lamb-outfit.cyclic.app"
                :
                "http://localhost:30000";
      function postTodo() {
        let todoText = document.querySelector("#todo").value;

        axios
          .post(`https://adorable-lamb-outfit.cyclic.app/todo`, {
            text: todoText,
          })
          .then(function (response) {
            console.log(response.data);

            document.querySelector("#result").innerHTML = "";

            response.data.data.map((eachTodo) => {
              document.querySelector("#result").innerHTML += eachTodo;
              document.querySelector("#result").innerHTML += "<br>"     
              
                
            });
          })
          .catch(function (error) {
            console.log(error);
          });
      }
      //DELETE TODO
      let deleteTodo = async (id) => {
        try {
          let response = await axios.delete(`${baseUrl}/todo/${id}`);

          document.querySelector("#message").innerHTML = response.data.message;
          setTimeout(() => {
            document.querySelector("#message").innerHTML = "";
          }, 2000);

          getAllTodos();
        } catch (error) {
          console.log("error: ", error);
        }
      };

      function getAllTodos() {
        axios
          .get(`https://adorable-lamb-outfit.cyclic.app/todos`)
          .then(function (response) {
            console.log(response.data);

            document.querySelector("#result").innerHTML = "";

            response.data.data.map((eachTodo) => {
              document.querySelector("#result").innerHTML += eachTodo.text;
              document.querySelector("#result").innerHTML += "<br>";
            });
          });
      }
      setInterval(getAllTodos, 1000);
      
      let deleteAllTodos = async () => {
        try {
          let response = await axios.delete(
            `https://adorable-lamb-outfit.cyclic.app/todos`
          );

          document.querySelector("#message").innerHTML = response.data.message;
          setTimeout(() => {
            document.querySelector("#message").innerHTML = "";
          }, 2000);

          document.querySelector("#result").innerHTML = "";
        } catch (error) {
          console.log("error: ", error);
        }
      };
    </script>
  </body>
</html>
